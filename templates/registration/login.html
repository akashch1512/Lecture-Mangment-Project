{% extends "base.html" %}
{% block title %}{% if role %}{{ role|title }} {% endif %}Login Â· LectureMap{% endblock %}
{% block content %}

<div class="container flex items-center justify-center min-h-screen py-12">
  <div class="w-full max-w-md">
    <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
        </svg>
      </div>
      
      {% if role %}
        <h1 class="text-2xl font-bold mb-2">{{ role|title }} Login</h1>
        <p class="text-muted">Sign in to access your {{ role|lower }} dashboard</p>
      {% else %}
        <h1 class="text-2xl font-bold mb-2">Welcome Back!</h1>
        <p class="text-muted">Sign in to access your account</p>
      {% endif %}
    </div>

    {% if not role %}
      <div class="grid grid-cols-2 gap-4 mb-8 animate-fade-in">
        <a href="{% url 'login_role' 'student' %}" class="card flex flex-col items-center p-6 hover:border-primary cursor-pointer no-underline">
          <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mb-3">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-bold mb-1">Student</h3>
          <p class="text-sm text-muted text-center">Track your course progress</p>
        </a>
        
        <a href="{% url 'login_role' 'teacher' %}" class="card flex flex-col items-center p-6 hover:border-primary cursor-pointer no-underline">
          <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mb-3">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
          </div>
          <h3 class="text-lg font-bold mb-1">Teacher</h3>
          <p class="text-sm text-muted text-center">Manage courses and topics</p>
        </a>
      </div>
    {% endif %}

    <div class="card animate-fade-in">
      {% if messages %}
        {% for message in messages %}
          <div class="mb-4 p-4 rounded-lg {% if message.tags == 'error' %}bg-red-50 text-red-700{% else %}bg-blue-50 text-blue-700{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}

      <form method="post" novalidate class="space-y-6">
        {% csrf_token %}
        {% if role %}
          <input type="hidden" name="role" value="{{ role }}">
        {% endif %}

        <div class="form-group">
          <label class="form-label" for="{{ form.username.id_for_label }}">Username</label>
          <input 
            type="text"
            name="{{ form.username.html_name }}"
            id="{{ form.username.id_for_label }}"
            class="form-input {% if form.username.errors %}border-red-500{% endif %}"
            value="{{ form.username.value|default_if_none:'' }}"
            required
          >
          {% if form.username.errors %}
            <div class="text-sm text-red-600 mt-1">{{ form.username.errors.as_text }}</div>
          {% endif %}
        </div>

        <div class="form-group">
          <label class="form-label" for="{{ form.password.id_for_label }}">Password</label>
          <div class="relative">
            <input
              type="password"
              name="{{ form.password.html_name }}"
              id="{{ form.password.id_for_label }}"
              class="form-input {% if form.password.errors %}border-red-500{% endif %}"
              required
            >
            <button 
              type="button"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
              onclick="togglePassword()"
            >
              <svg id="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <svg id="eye-off-icon" class="hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-10-7-10-7s.21-1.63.88-2.66m6.7-6.7C9.22 4.64 7.51 5 6 5c-7 0-10 7-10 7s1.77 3.33 4.69 5.25"></path>
                <path d="M9.9 9.9l4.2 4.2"></path>
                <circle cx="12" cy="12" r="3"></circle>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </button>
          </div>
          {% if form.password.errors %}
            <div class="text-sm text-red-600 mt-1">{{ form.password.errors.as_text }}</div>
          {% endif %}
        </div>

        <button type="submit" class="btn btn-primary w-full mb-4">
          Sign in {% if role %}as {{ role|title }}{% endif %}
        </button>

        <div class="text-center">
          <a href="{% url 'password_reset' %}" class="text-sm text-primary hover:underline">
            Forgot your password?
          </a>
        </div>

        {% if role %}
          <div class="text-center mt-4 pt-4 border-t border-gray-200">
            <p class="text-sm text-muted mb-2">Not a {{ role }}?</p>
            <div class="flex justify-center gap-2">
              {% if role == 'student' %}
                <a href="{% url 'login_role' 'teacher' %}" class="text-sm text-primary hover:underline">Login as Teacher</a>
              {% else %}
                <a href="{% url 'login_role' 'student' %}" class="text-sm text-primary hover:underline">Login as Student</a>
              {% endif %}
            </div>
          </div>
        {% endif %}

        <div class="text-center mt-4">
          <p class="text-sm text-muted">Don't have an account?
            <a href="{% url 'signup' %}" class="text-primary hover:underline">Sign up</a>
          </p>
        </div>
      </form>

      <script>
        function togglePassword() {
          const pwd = document.getElementById('{{ form.password.id_for_label }}');
          const eyeIcon = document.getElementById('eye-icon');
          const eyeOffIcon = document.getElementById('eye-off-icon');
          
          if (pwd.type === 'password') {
            pwd.type = 'text';
            eyeIcon.classList.add('hidden');
            eyeOffIcon.classList.remove('hidden');
          } else {
            pwd.type = 'password';
            eyeIcon.classList.remove('hidden');
            eyeOffIcon.classList.add('hidden');
          }
        }
      </script>
    </div>
  </div>
</div>
  

<script>
  // Initialize password toggle logic
  document.addEventListener('DOMContentLoaded', function() {
    
    let password = document.getElementById("{{ form.password.id_for_label }}");
    const btn = document.getElementById("togglePwd");
    const eyeIcon = document.getElementById("eye-icon");
    const eyeOffIcon = document.getElementById("eye-off-icon");

    // Password show/hide toggle logic
    if (btn && password) {
      btn.addEventListener("click", function () {
        const isPassword = password.type === "password";
        
        // Toggle type
        password.type = isPassword ? "text" : "password";
        
        // Toggle icon and aria-label for accessibility
        if (isPassword) {
          btn.setAttribute('aria-label', 'Hide password');
          eyeIcon.style.display = 'none';
          eyeOffIcon.style.display = 'block';
        } else {
          btn.setAttribute('aria-label', 'Show password');
          eyeIcon.style.display = 'block';
          eyeOffIcon.style.display = 'none';
        }
        
        // Focus on the password field after toggling
        password.focus();
      });
    }
  });
</script>

{% endblock %}