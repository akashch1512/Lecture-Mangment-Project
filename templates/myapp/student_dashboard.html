{% extends "base.html" %}
{% block title %}Student Dashboard{% endblock %}

{% block content %}
<div class="animate-fade-in">
  <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:28px">
    <div>
      <h1 style="font-size:1.5rem;margin:0 0 6px;font-weight:700">Student Dashboard</h1>
      <p style="margin:0;color:var(--muted)">Track your progress across subjects</p>
    </div>

    <div>
      <a href="{% url 'profile' %}" class="btn btn-outline" style="display:inline-flex;align-items:center;gap:8px">
        <!-- small profile icon -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z" fill="currentColor" />
          <path d="M4 20c0-2.21 3.58-4 8-4s8 1.79 8 4v1H4v-1z" fill="rgba(0,0,0,0.6)" />
        </svg>
        View Profile
      </a>
    </div>
  </header>

  {% if not subjects %}
    <div class="card text-center py-8">
      <svg class="mx-auto mb-4" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
      <h2 class="text-xl font-bold mb-2">No subjects yet</h2>
      <p class="text-muted">You're not enrolled in any subjects.</p>
    </div>
  {% else %}
    <div class="grid grid-cols-2 gap-4">
      {% for s in subjects %}
        <div class="card">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h3 class="text-lg font-bold">{{ s.name }}</h3>
              <p class="text-muted">{{ s.class_name }}</p>
            </div>
            <a href="{% url 'subject_detail' s.id %}" class="btn btn-outline">View Details</a>
          </div>
          
          <div class="mb-4">
            <div class="flex justify-between items-center mb-2">
              <!-- <span class="text-sm font-medium">Progress</span>
              <span class="text-sm text-muted">{{ s.progress_percent }}%</span> -->
            </div>
            <div hx-get="{% url 'progress_partial' s.id %}" 
                 hx-trigger="load every 3s" 
                 hx-swap="outerHTML" 
                 data-progress-bar>
              {% include "myapp/_progress_bar.html" with subject=s %}
            </div>
          </div>

          <div class="flex justify-between items-center text-sm">
            <span class="text-muted">
              {{ s.conducted_lectures }} / {{ s.planned_lectures }} lectures
            </span>
            {% if s.end_date %}
              <span class="badge {% if s.end_date|timeuntil:today > '30 days' %}badge-success{% else %}badge-warning{% endif %}">
                {{ s.end_date|timeuntil }} left
              </span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
